# 样本选择和选择难题
## 选择难题和样本选择问题的区别：
+ 样本选择问题：选取的样本是否足够随机，从而能够代表总体；
    * 由被解释变量 $y_i$ 是否可测（部分可测）决定，不可测的个体无法进入样本；
    * 可以使用断尾、归并和样本选择（Heckman两步法）解决样本选择问题；
+ 选择难题：个体会根据预期收益来决定自己是否接受处理（培训等政策效应）；
    * 可以通过随机分组进行解决，但有时随机分组成本较高；
    * 满足可忽略性假定（均值独立假定）：
        - 可忽略性假定：在协变量 $x_i$ 存在的条件下，结果变量$y_{0i},y_{1i}$与处理变量$D_i$无关；
            + $F(y_{0i},y_{1i}|x_i,D_i=1)=F(y_{0i},y_{1i}|x_i,D_i=0)$
        - 均值独立假定：在协变量 $x_i$ 存在的条件下，结果变量$y_{0i},y_{1i}$的均值均独立于$D_i$;
            + $E(y_{0i},y_{1i}|x_i,D_i)=E(y_{0i},y_{1i}|x_i)$
        - 而根据解释变量即协变量 $x_i$ 是否可测，选择不同的模型来估计处理效应；
            +  $x_i$ 可测时，选择倾向得分匹配；
            +  $x_i$ 不可测时，选择:PSM-DID,RD,处理效应模型；

## 一个案例：就业培训项目的处理效应评估
+ 直接对比参加培训（实验组）和未参加培训（控制组）的未来收入情况，会发现参加培训的人未来收入可能会更低；
    + 原因是：是否参加培训是参加者自我选择(self selection)的结果，失业者、低收入者更倾向于参加培训;
    + 实验组和对照组初始条件不完全相同，故存在“选择偏差”(selection bias);

## 反事实框架
+ 处理组：参加培训的人；
+ 对照组：参加培训的人如果未参加培训；
+ 以上两种状态只能观测到一种，而无法同时观测到；
+ 选择偏差：  
$$
E(y_{1i}|D_i=1)-E(y_{0i}|D_i=0)=E(y_{1i}|D_i=1)-E(y_{0i}|D_i=1)+ E(y_{0i}|D_i=1)-E(y_{0i}|D_i=0)
$$  

+ 参与者平均处理效应：  $ATT=E(y_{1i}-y_{0i}|D_i=1)$ 
+ 非参与者平均处理效应：  $ATU=E(y_{1i}-y_{0i}|D_i=0)$ 

## 解决选择难题：
+ 方法一：随机分组，个体是否参加培训或实验由抛硬币或电脑随机决定；
    + 条件期望等于无条件期望，即均值独立： $E(y_{1i}|D_i)=E(y_{1i})$ ；
    + 但是随机分组并不总是可行，可能成本太高；
+ 方法二：依可测变量选择（可忽略性假定），个体是否参加培训或实验由可观测的变量  $x_i$ 决定；
    + 即在给定 $x_i$ 的条件下均值独立： $E(y_{1i}|x_i D_i=1)=E(y_{1i}|x_i)$ ；
    + 匹配估计量：在控制组找到一个和它一样的个体；
    + 倾向得分匹配：个体进入实验组的概率；
        + 使用logit或probit计算个体倾向得分（进入实验组概率）；
        + 满足“重叠假定”或“匹配假定”； 存在较多的共同取值的倾向得分；
+ 方法三：依不可测变量选择，有以下几种处理方法：
    + 尽可能多地使用可测变量，以满足可忽略性假定，然后使用匹配估计量；
    + 使用双重差分倾向得分匹配估计量(PSM-DID)：如果影响处理变量 $D_i$ 的不可观测变量不随时间而变，而且有面板数据，具体操作见"PSM-DID.do"和"PSM-DID.md"；
    + 使用断点回归法(RD)，特别是模糊断点回归：处理变量 $D_i$ 完全由某连续变量 $x_i$ 是否超过某个断点而决定，例如高考成绩，500分和501分的考生在各方面都没有系统差异，无论是否包含可测变量和不可测变量，具体操作见"rd.do"；
    + 使用工具变量法：工具变量很难获得，较难找到既影响个体参加项目的决定 $D_i$ ，又与是否参加项目潜在的结果变量( $y_{0i},y_{1i}$ ) 无关；
    + 根据依可测变量选择的影响来估计依不可测变量选择的影响；
    + 处理效应模型：遵循Heckman的样本选择模型的传统，直接对 $D_i$ 处理变量进行结果建模；

## 处理效应模型



